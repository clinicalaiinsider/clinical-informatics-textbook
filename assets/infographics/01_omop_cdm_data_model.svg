<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800" width="1200" height="800">
  <defs>
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#1a365d;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2c5282;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="clinicalGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4299e1;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#3182ce;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="healthSystemGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#48bb78;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#38a169;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="notesGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ed8936;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#dd6b20;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4a5568"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1200" height="800" fill="#f7fafc"/>

  <!-- Header -->
  <rect x="0" y="0" width="1200" height="70" fill="url(#headerGrad)"/>
  <text x="600" y="45" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="white" text-anchor="middle">OMOP Common Data Model 5.4 - Table Relationships</text>

  <!-- Section: Clinical Data -->
  <rect x="40" y="100" width="1120" height="380" rx="10" fill="#ebf8ff" stroke="#4299e1" stroke-width="2" filter="url(#shadow)"/>
  <rect x="40" y="100" width="1120" height="40" rx="10" fill="url(#clinicalGrad)"/>
  <text x="600" y="127" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="white" text-anchor="middle">CLINICAL DATA TABLES</text>

  <!-- PERSON box -->
  <rect x="80" y="180" width="140" height="80" rx="8" fill="white" stroke="#2c5282" stroke-width="2" filter="url(#shadow)"/>
  <rect x="80" y="180" width="140" height="30" rx="8" fill="#2c5282"/>
  <text x="150" y="200" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">PERSON</text>
  <text x="150" y="225" font-family="Arial, sans-serif" font-size="11" fill="#4a5568" text-anchor="middle">person_id</text>
  <text x="150" y="240" font-family="Arial, sans-serif" font-size="11" fill="#4a5568" text-anchor="middle">gender, birth_year</text>
  <text x="150" y="255" font-family="Arial, sans-serif" font-size="11" fill="#4a5568" text-anchor="middle">race, ethnicity</text>

  <!-- VISIT_OCCURRENCE box -->
  <rect x="320" y="180" width="180" height="80" rx="8" fill="white" stroke="#2c5282" stroke-width="2" filter="url(#shadow)"/>
  <rect x="320" y="180" width="180" height="30" rx="8" fill="#2c5282"/>
  <text x="410" y="200" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">VISIT_OCCURRENCE</text>
  <text x="410" y="225" font-family="Arial, sans-serif" font-size="11" fill="#4a5568" text-anchor="middle">visit_occurrence_id</text>
  <text x="410" y="240" font-family="Arial, sans-serif" font-size="11" fill="#4a5568" text-anchor="middle">visit_concept_id</text>
  <text x="410" y="255" font-family="Arial, sans-serif" font-size="11" fill="#4a5568" text-anchor="middle">visit_start/end_date</text>

  <!-- Arrow: PERSON to VISIT -->
  <line x1="220" y1="220" x2="315" y2="220" stroke="#4a5568" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- CONDITION_OCCURRENCE box -->
  <rect x="600" y="160" width="180" height="70" rx="8" fill="white" stroke="#e53e3e" stroke-width="2" filter="url(#shadow)"/>
  <rect x="600" y="160" width="180" height="25" rx="8" fill="#e53e3e"/>
  <text x="690" y="178" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">CONDITION_OCCURRENCE</text>
  <text x="690" y="200" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">condition_concept_id</text>
  <text x="690" y="215" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">condition_start_date</text>

  <!-- MEASUREMENT box -->
  <rect x="600" y="245" width="180" height="70" rx="8" fill="white" stroke="#38a169" stroke-width="2" filter="url(#shadow)"/>
  <rect x="600" y="245" width="180" height="25" rx="8" fill="#38a169"/>
  <text x="690" y="263" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">MEASUREMENT</text>
  <text x="690" y="285" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">measurement_concept_id</text>
  <text x="690" y="300" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">value_as_number, unit</text>

  <!-- DRUG_EXPOSURE box -->
  <rect x="600" y="330" width="180" height="70" rx="8" fill="white" stroke="#805ad5" stroke-width="2" filter="url(#shadow)"/>
  <rect x="600" y="330" width="180" height="25" rx="8" fill="#805ad5"/>
  <text x="690" y="348" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">DRUG_EXPOSURE</text>
  <text x="690" y="370" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">drug_concept_id</text>
  <text x="690" y="385" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">quantity, days_supply</text>

  <!-- PROCEDURE_OCCURRENCE box -->
  <rect x="600" y="415" width="180" height="55" rx="8" fill="white" stroke="#dd6b20" stroke-width="2" filter="url(#shadow)"/>
  <rect x="600" y="415" width="180" height="25" rx="8" fill="#dd6b20"/>
  <text x="690" y="433" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">PROCEDURE_OCCURRENCE</text>
  <text x="690" y="455" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">procedure_concept_id</text>

  <!-- OBSERVATION box -->
  <rect x="880" y="280" width="160" height="70" rx="8" fill="white" stroke="#319795" stroke-width="2" filter="url(#shadow)"/>
  <rect x="880" y="280" width="160" height="25" rx="8" fill="#319795"/>
  <text x="960" y="298" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">OBSERVATION</text>
  <text x="960" y="320" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">observation_concept_id</text>
  <text x="960" y="335" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">value_as_string</text>

  <!-- Arrows from VISIT to clinical tables -->
  <line x1="500" y1="200" x2="595" y2="195" stroke="#4a5568" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="500" y1="220" x2="595" y2="280" stroke="#4a5568" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="500" y1="240" x2="595" y2="365" stroke="#4a5568" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="500" y1="250" x2="595" y2="442" stroke="#4a5568" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Arrow from PERSON to OBSERVATION -->
  <path d="M 150 260 L 150 315 L 875 315" stroke="#4a5568" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Section: Health System -->
  <rect x="40" y="510" width="550" height="130" rx="10" fill="#f0fff4" stroke="#48bb78" stroke-width="2" filter="url(#shadow)"/>
  <rect x="40" y="510" width="550" height="35" rx="10" fill="url(#healthSystemGrad)"/>
  <text x="315" y="533" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">HEALTH SYSTEM TABLES</text>

  <!-- LOCATION box -->
  <rect x="70" y="560" width="130" height="60" rx="6" fill="white" stroke="#38a169" stroke-width="2" filter="url(#shadow)"/>
  <rect x="70" y="560" width="130" height="22" rx="6" fill="#38a169"/>
  <text x="135" y="576" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">LOCATION</text>
  <text x="135" y="598" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">location_id</text>
  <text x="135" y="612" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">city, state, zip</text>

  <!-- CARE_SITE box -->
  <rect x="250" y="560" width="130" height="60" rx="6" fill="white" stroke="#38a169" stroke-width="2" filter="url(#shadow)"/>
  <rect x="250" y="560" width="130" height="22" rx="6" fill="#38a169"/>
  <text x="315" y="576" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">CARE_SITE</text>
  <text x="315" y="598" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">care_site_id</text>
  <text x="315" y="612" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">care_site_name</text>

  <!-- PROVIDER box -->
  <rect x="430" y="560" width="130" height="60" rx="6" fill="white" stroke="#38a169" stroke-width="2" filter="url(#shadow)"/>
  <rect x="430" y="560" width="130" height="22" rx="6" fill="#38a169"/>
  <text x="495" y="576" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">PROVIDER</text>
  <text x="495" y="598" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">provider_id, NPI</text>
  <text x="495" y="612" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">specialty</text>

  <!-- Arrows for health system -->
  <line x1="200" y1="590" x2="245" y2="590" stroke="#4a5568" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="380" y1="590" x2="425" y2="590" stroke="#4a5568" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Section: Clinical Notes -->
  <rect x="620" y="510" width="540" height="130" rx="10" fill="#fffaf0" stroke="#ed8936" stroke-width="2" filter="url(#shadow)"/>
  <rect x="620" y="510" width="540" height="35" rx="10" fill="url(#notesGrad)"/>
  <text x="890" y="533" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">CLINICAL NOTES</text>

  <!-- NOTE box -->
  <rect x="800" y="560" width="180" height="60" rx="6" fill="white" stroke="#dd6b20" stroke-width="2" filter="url(#shadow)"/>
  <rect x="800" y="560" width="180" height="22" rx="6" fill="#dd6b20"/>
  <text x="890" y="576" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">NOTE</text>
  <text x="890" y="598" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">note_id, note_text</text>
  <text x="890" y="612" font-family="Arial, sans-serif" font-size="10" fill="#4a5568" text-anchor="middle">Linked to PERSON &amp; VISIT</text>

  <!-- Legend -->
  <rect x="40" y="670" width="1120" height="100" rx="8" fill="white" stroke="#e2e8f0" stroke-width="1" filter="url(#shadow)"/>
  <text x="60" y="695" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2d3748">Key Relationships:</text>

  <circle cx="80" cy="720" r="6" fill="#2c5282"/>
  <text x="95" y="725" font-family="Arial, sans-serif" font-size="12" fill="#4a5568">Core Tables (Person, Visit)</text>

  <circle cx="280" cy="720" r="6" fill="#e53e3e"/>
  <text x="295" y="725" font-family="Arial, sans-serif" font-size="12" fill="#4a5568">Diagnoses</text>

  <circle cx="400" cy="720" r="6" fill="#38a169"/>
  <text x="415" y="725" font-family="Arial, sans-serif" font-size="12" fill="#4a5568">Measurements (Labs/Vitals)</text>

  <circle cx="600" cy="720" r="6" fill="#805ad5"/>
  <text x="615" y="725" font-family="Arial, sans-serif" font-size="12" fill="#4a5568">Medications</text>

  <circle cx="750" cy="720" r="6" fill="#dd6b20"/>
  <text x="765" y="725" font-family="Arial, sans-serif" font-size="12" fill="#4a5568">Procedures</text>

  <circle cx="880" cy="720" r="6" fill="#319795"/>
  <text x="895" y="725" font-family="Arial, sans-serif" font-size="12" fill="#4a5568">Observations</text>

  <text x="60" y="755" font-family="Arial, sans-serif" font-size="11" fill="#718096">All clinical events link to PERSON via person_id and optionally to VISIT_OCCURRENCE via visit_occurrence_id</text>

  <!-- Footer -->
  <text x="1160" y="785" font-family="Arial, sans-serif" font-size="10" fill="#a0aec0" text-anchor="end">Clinical Informatics Textbook - OMOP CDM 5.4</text>
</svg>